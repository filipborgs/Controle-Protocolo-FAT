<!DOCTYPE html>

<html lang="br" >

    <head>

        <meta charset="UTF-8">

        <!--====== TITLE TAG ======-->
        <title>Gerenciador de Protocolos</title>

        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="assest/js/vendor/jquery-1.12.4.min.js"></script>

        <!-- ===== BOOTSTRAP ===== 
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" >
        -->



        <!--====== FAVICON ICON =======-->
        <link rel="shortcut icon" type="image/ico" href="assest/img/favicon.png" />

        <!-- /\/\/\/\ TABLE RESPONSIVE /\/\/\/\ -->

        <link rel="stylesheet" href="assest/css/normalize.css">
        <link rel="stylesheet" href="assest/css/demo.css">
        <!-- Pushy CSS -->
        <link rel="stylesheet" href="assest/css/pushy.css">

        <script src="assest/js/project/dados_connection.js"></script>
        <script src="assest/js/project/control_user.js"></script>
        <script src="assest/js/project/alertas.js"></script>
        <!-- ===== TABLE RESPONSIVE ===== -->
        <link rel="stylesheet" href="assest/css/style.css">
        <link rel="stylesheet" href="assest/css/styles.css">
        
        
        <!-- \/\/\/\/\/\/\/\/ SCRIPTS JS \/\/\/\/\/\/\/\/ -->
        <script>
            
            /* 
             *  **********   FUNÇÃO PARA SALVAR EDIAÇÃO DO LIVRO E 
             *  ********** REALIZAR ENVIO DO JSON PARA FAZER O UPDATE 
             */

            function SalveEdition() {

                alert("Salvar edição");
                
                cleanInputs();

            }
            
            /* 
             *  **********   FUNÇÃO PARA VALIDAR OS CAMPOS DE INPUT 
             *  **********       ANTES DE ENVIAR O FORMULÁRIO 
             */

            function ValidaCampos() {

                return true;

            }
            
            /* 
             *  **********   FUNÇÃO PARA EXCLUIR UM LIVRO, 
             *  ********** REALIZAR ENVIO DO JSON COM O ID PARA FAZER O UPDATE 
             */

            function RemoveItem(id) {
                alert("Remover");
            }
            
            /* 
             *  **********   FUNÇÃO PARA OBTER OS CAMPOS DE INPUT E 
             *  ********** REALIZAR ENVIO DO JSON PARA FAZER O UPDATE 
             */

            function EditaItem(id) {

                $("#div-protocols").empty();

                div_creat = document.getElementById("div-create-protocol");

                div_creat.removeAttribute("style");
                div_creat.setAttribute("style", "display:flow-root;");

                btn_save = document.getElementById("btn_save");
                btn_save.removeAttribute("onclick");
                btn_save.setAttribute("onclick", "SalveEdition()");

                var metodo = "livro/listarLivros";
                var tokin = localStorage.getItem("Dw33&121#$%8\z|^");

                $.ajax
                        ({
                            url: uri + metodo,
                            type: 'GET',
                            data:
                                    {
                                        tokin: tokin
                                    },
                            beforeSend: function () {
                                //alert("ENTRANDO...");
                            }
                        })
                        .done(function (returnJson) {

                            // ITERA O JSON (LINHA A LINHA) E CHAMA O METODO QUE PREENCHE A TABELA
                            for (var i = 0; i < livros.length; i++) {

                                if (livros[i].numero === parseInt(id)) {
                                    
                                    console.log(livros[i]);

                                    document.getElementById("numero").value = livros[i].numero;
                                    document.getElementById("nome").value = livros[i].nome;
                                    document.getElementById("folhas").value = livros[i].folhas;
                                    document.getElementById("cor").value = livros[i].cor;
                                    document.getElementById("dtinicio").value = livros[i].dataInicio;
                                    document.getElementById("detalhes").append(livros[i].detalhes);

                                }

                            }
                        })
                        .fail(function (msg) {
                            alert("Falha ao tentar obter a lista de livros");
                            console.log(msg);
                        });




            }
            
            /* 
             *  **********   FUNÇÃO PARA CHAMAR A EXIBIÇÃO DO MODAL 
             *  ********** QUE APRESENTA AS OPÇÕES DE EXCLUIR E EDITAR
             */

            function chamaModal(id) {

                sendMensage = document.getElementById("sendMensage");
                $("#sendMensage").empty();

                excluir = document.createElement("input");
                excluir.setAttribute("type", "submit");
                excluir.setAttribute("value", "excluir");
                excluir.setAttribute("class", "btn-danger");
                excluir.setAttribute("onclick", "RemoveItem(" + id + ")");

                editar = document.createElement("input");
                editar.setAttribute("type", "submit");
                editar.setAttribute("value", "editar");
                editar.setAttribute("style", "margin-right: 10px; margin-top: 10px;");
                editar.setAttribute("onclick", "EditaItem(" + id + ")");

                if (localStorage.getItem('sdw3354SD&@!5231') === 'S') {
                    sendMensage.appendChild(excluir);
                }

                if (localStorage.getItem('zXGT*&&!3YHRU+|D') === 'S') {
                    sendMensage.appendChild(editar);
                }

                window.location.href = "#popup1";
            }

            /* 
             *  **********   FUNÇÃO PARA OBTER OS CAMPOS DO INPUT E 
             *  ********** REALIZAR ENVIO DO JSON PARA FAZER O INSERT (CADASTRAR LIVRO) 
             */

            function SendInputForm() {

                numero = document.getElementById("numero").value;
                nome = document.getElementById("nome").value;
                folhas = document.getElementById("folhas").value;
                cor = document.getElementById("cor").value;
                dtinicio = document.getElementById("dtinicio").value;
                detalhes = document.getElementById("detalhes").value;

                var metodo = "livro/cadastrarLivro";
                var tokin = localStorage.getItem("Dw33&121#$%8\z|^");

                $.ajax
                        ({
                            url: uri + metodo,
                            type: 'POST',
                            data: JSON.stringify(
                                    {
                                        folhas: folhas,
                                        numero: numero,
                                        nome: nome,
                                        detalhes: detalhes,
                                        cor: cor,
                                        dataInicio: dtinicio
                                    }),
                            contentType: 'application/json',
                            beforeSend: function () {
                                //alert("ENTRANDO...");
                            }
                        })
                        .done(function (returnJson) {

                            if (returnJson.numero == numero) {
                                sendMensage = document.getElementById("sendMensage");
                                $("#sendMensage").empty();
                                sendMensage.append("Sucesso!");
                                window.location.href = "#popup1";
                                cleanInputs();
                            } else {



                            }

                        })
                        .fail(function (msg) {
                            alert("Falha ao tentar cadastrar livro");
                            console.log(msg);
                        });
            }

            /* 
             *  **********   FUNÇÃO PARA LIMPAR TODOS OS CAMPOS DA TELA 
             */

            function cleanInputs() {

                document.getElementById("numero").value("");
                document.getElementById("nome").value("");
                document.getElementById("folhas").value("");
                document.getElementById("cor").value("");
                document.getElementById("dtinicio").value("");
                document.getElementById("detalhes").value("");


            }

            /* 
             *  **********   FUNÇÃO PARA CHAMAR O FORMULÁRIO DE CADASTRO DE LIVRO 
             *  **********          E REMOVER A TABELA DE LIVROS DA TELA
             */
            
            function CallForm() {

                $("#div-protocols").empty();

                div_creat = document.getElementById("div-create-protocol");

                div_creat.removeAttribute("style");
                div_creat.setAttribute("style", "display:flow-root;");

                btn_save = document.getElementById("btn_save");
                btn_save.removeAttribute("onclick");
                btn_save.setAttribute("onclick", "SendInputForm()");

            }
            
            /* 
             *  **********       CHAMADO ATRAVES DO BOTÃO CANCELAR CADASTRO 
             *  ********** FUNÇÃO QUE OCULTA O FORMULÁRIO E CHAMA A TABELA DE LIVROS 
             */

            function RemoveForm() {

                $("#div-protocols").empty();

                div_creat = document.getElementById("div-create-protocol");

                div_creat.removeAttribute("style");
                div_creat.setAttribute("style", "display:none;");

                GetListLivros();

            }
            
            /* 
             *  **********   FUNÇÃO PARA EXIBIR TODOS OS LIVROS CADASTRADOS 
             *  **********  REALIZAR UMA CHAMADA JSON PARA RECEBER OS DADOS
             *  **********           CRIAR UMA TABELA E PREENCHER 
             */

            function GetListLivros() {

                var metodo = "livro/listarLivros";
                var tokin = localStorage.getItem("Dw33&121#$%8\z|^");

                $.ajax
                        ({
                            url: uri + metodo,
                            type: 'GET',
                            data:
                                    {
                                        tokin: tokin
                                    },
                            beforeSend: function () {
                                //alert("ENTRANDO...");
                            }
                        })
                        .done(function (returnJson) {

                            //var livros = JSON.parse(returnJson);
                    
                            livros = returnJson;
                            console.log(livros);
                            // PEGA A DIV PAI E ESVAZIA ELA
                            tdiv = document.getElementById("div-protocols");
                            $("#div-protocols").empty();



                            // CRIA A TABELA E SETA OS ATRIBUTOS
                            ttable = document.createElement("table");
                            ttable.setAttribute("class", "rwd-table");
                            ttable.setAttribute("id", "table-protocols");

                            // CRIA O THEAD E O TBODY E SETA OS ATRIBUTOS
                            tthead = document.createElement("thead");
                            ttbody = document.createElement("tbody");
                            ttbody.setAttribute("id", "tboby-protocols");

                            // CRIA A LINHA DO TÍTULO E AS COLUNAS E INSERI AS STRINGS
                            trowhead = document.createElement("tr");

                            tcolNumerohead = document.createElement("th");
                            tcolNomehead = document.createElement("th");
                            tcolFolhashead = document.createElement("th");
                            tcolCorhead = document.createElement("th");
                            tcolIniciohead = document.createElement("th");
                            tcolFimhead = document.createElement("th");
                            tcolDetalheshead = document.createElement("th");

                            tcolNumerohead.append("Número");
                            tcolNomehead.append("Nome");
                            tcolFolhashead.append("Folhas");
                            tcolCorhead.append("Cor");
                            tcolIniciohead.append("Abertura");
                            tcolFimhead.append("Término");
                            tcolDetalheshead.append("Detalhes");

                            // INSERI AS COLUNAS DO TÍTULO NA LINHA DO TÍTULO
                            trowhead.appendChild(tcolNumerohead);
                            trowhead.appendChild(tcolNomehead);
                            trowhead.appendChild(tcolFolhashead);
                            trowhead.appendChild(tcolCorhead);
                            trowhead.appendChild(tcolIniciohead);
                            trowhead.appendChild(tcolFimhead);
                            trowhead.appendChild(tcolDetalheshead);

                            // INSERI A LINHA DO TÍTULO NO THEAD
                            tthead.appendChild(trowhead);

                            // INSERI O THEAD E O TBODY DENTRO DA TABELA
                            ttable.appendChild(tthead);
                            ttable.appendChild(ttbody);

                            // INSERI A TABELA DENTRO DA DIV
                            tdiv.appendChild(ttable);

                            // /\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\
                            // \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/

                            // ITERA O JSON (LINHA A LINHA) E CHAMA O METODO QUE PREENCHE A TABELA
                            for (var i = 0; i < livros.length; i++) {

                                PreencheTboby(livros[i]);

                            }

                            function PreencheTboby(livro) {

                                // CRIA A LINHA
                                trow = document.createElement("tr");
                                if ((localStorage.getItem('sdw3354SD&@!5231') === 'S') || (localStorage.getItem('zXGT*&&!3YHRU+|D') === 'S')) {
                                    trow.setAttribute("onclick", "chamaModal(" + livro.numero + ")");
                                }
                                //trow.setAttribute("","");
                                //trow.setAttribute("","");

                                // CRIA AS COLUNAS
                                tcolNumero = document.createElement("td");
                                tcolNome = document.createElement("td");
                                tcolFolhas = document.createElement("td");
                                tcolCor = document.createElement("td");
                                tcolInicio = document.createElement("td");
                                tcolFim = document.createElement("td");
                                tcolDetalhes = document.createElement("td");

                                // ADICIONA ATRIBUTOS A COLUNA QUE GARANTE O TITULO NA RESPONSIVIDADE
                                tcolNumero.setAttribute("data-th", "Número");
                                tcolNome.setAttribute("data-th", "Nome");
                                tcolFolhas.setAttribute("data-th", "Folhas");
                                tcolCor.setAttribute("data-th", "Cor");
                                tcolInicio.setAttribute("data-th", "Abertura");
                                tcolFim.setAttribute("data-th", "Término");
                                tcolDetalhes.setAttribute("data-th", "Detalhes");

                                // INSERI O CONTEUDO DO JSON NA COLUNA DO CORPO DA TABELA
                                tcolNumero.append(livro.numero);
                                tcolNome.append(livro.nome);
                                tcolFolhas.append(livro.folhas);
                                tcolCor.append(livro.cor);
                                tcolInicio.append(livro.dataInicio);
                                tcolFim.append(livro.dataFim);
                                tcolDetalhes.append(livro.detalhes);

                                // INSERI AS COLUNAS DENTRO DA LINHA
                                trow.appendChild(tcolNumero);
                                trow.appendChild(tcolNome);
                                trow.appendChild(tcolFolhas);
                                trow.appendChild(tcolCor);
                                trow.appendChild(tcolInicio);
                                trow.appendChild(tcolFim);
                                trow.appendChild(tcolDetalhes);

                                // INSERI O CORPO DENTRO DA TABELA
                                ttbody.appendChild(trow);

                            }

                        })
                        .fail(function (msg) {
                            alert("Falha ao tentar obter a lista de livros");
                            console.log(msg);
                        });

            }

        </script>

        <style>

            .footer {
                bottom:0;
                width:100%;
                padding-left:0px;
                padding-top:10%;
                padding-bottom:0px;

            }

        </style>

    </head>

    <body onload="GetListLivros();">

        <!-- \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/ NAV MENU \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/ -->
        <nav class="pushy pushy-left" data-focus="#first-link">
            <div class="pushy-content">
                <ul>
                    <li class="pushy-link"><a href="protocolos.html">Protocolos</a></li>
                    <li class="pushy-link"><a href="livros.html">Livros</a></li>
                    <li class="pushy-link"><a href="pessoas.html">Pessoas</a></li>
                    <li class="pushy-link"><a href="motivos.html">Motivos</a></li>
                    <li class="pushy-link"><a href="situacoes.html">Situações</a></li>
                    <li class="pushy-link"><a href="javascript:logout();">Sair</a></li>
                </ul>
            </div>
        </nav>

        <!-- \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/ DIV MENU \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/ -->
        <div id="container" style="padding-left:0px;padding-top:40px;padding-bottom:0px;height:50px;">
            <!-- Menu Button -->
            <button class="menu-btn">&#9776; Menu</button>
            <div>
                <img src="assest/img/new.png" height="45" style="cursor:pointer;" onclick="CallForm();"  width="47" title="Adicionar" />
            </div>
        </div>

        <!-- Pushy JS -->
        <script src="assest/js/pushy.min.js"></script>

        <!-- \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/ TÍTULO \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/ -->

        <h1 align="center" >
            Livros
        </h1>

        <br/>
        <!-- \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/ DIV TABELA \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/ -->
        <div id="div-protocols" >

        </div>


        <div id="popup1" class="overlay">
            <div class="popup">
                <h2 style="text-align: center;">Mensagem:</h2>
                <a class="close" href="#">&times;</a>
                <div class="content" id="sendMensage">
                </div>
            </div>
        </div>

        <!-- \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/ DIV FORM \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/ -->
        <div id="div-create-protocol" style="display:none;" >

            <div class="container">


                <div class="row">
                    <div class="col-25">
                        <label for="numero">Número</label>
                    </div>
                    <div class="col-75">
                        <input type="number" required id="numero" name="numero" placeholder="obrigatório">
                    </div>
                </div>
                <div class="row">
                    <div class="col-25">
                        <label for="nome">Nome</label>
                    </div>
                    <div class="col-75">
                        <input type="text" required id="nome" name="nome" placeholder="obrigatório">
                    </div>
                </div>
                <div class="row">
                    <div class="col-25">
                        <label for="folhas">Folhas</label>
                    </div>
                    <div class="col-75">
                        <input type="number" id="folhas" required name="folhas" placeholder="obrigatório">
                    </div>
                </div>
                <div class="row">
                    <div class="col-25">
                        <label for="cor">Cor</label>
                    </div>
                    <div class="col-75">
                        <input type="text" id="cor" name="cor" />
                    </div>
                </div>
                <div class="row">
                    <div class="col-25">
                        <label for="dtinicio">Data Início</label>
                    </div>
                    <div class="col-75">
                        <input type="date" id="dtinicio" name="dtinicio"  />
                    </div>
                </div>
                <div class="row">
                    <div class="col-25">
                        <label for="detalhes">Detalhes</label>
                    </div>
                    <div class="col-75">
                        <textarea id="detalhes" name="detalhes" style="height:100px"></textarea>
                    </div>
                </div>
                <div class="row">
                    <br/>
                    <input type="submit" style="margin-top: 10px" id="btn_save" onclick="SendInputForm();" value="Salvar" />
                    <input type="submit" onclick="RemoveForm();" class="btn-danger" value="Cancelar" />
                </div>


            </div>

        </div>

        <!-- \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/ DIV RODAPE \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/ -->
        <div>
            <footer class="footer">
                <!--FOOER AREA END-->
                <p align="center">Desenvolvido pela turma de Sistemas para Internet<br/> Faculdade Anísio Teixeira - 2018.2</p>
            </footer>
        </div>

    </body>

</html>
